{% extends 'cms/base.html' %}

{% block title %}Cities - CMS{% endblock %}

{% block cms_content %}
<div class="cms-header d-flex justify-content-between align-items-center">
    <div>
        <h1>Cities</h1>
        <p class="text-muted mb-0">Manage Hampton Roads cities and their venues.</p>
    </div>
</div>

{% for region in regions %}
<div class="cms-card mb-4">
    <div class="cms-card-header">
        <h5 class="mb-0">{{ region.name }}</h5>
        <span class="badge bg-secondary">{{ region.cities.count }} cities</span>
    </div>
    <div class="cms-card-body">
        <div class="row g-4">
            {% for city in cities %}
            {% if city.region_id == region.id %}
            <div class="col-md-6 col-lg-4">
                <div class="content-card h-100">
                    <div class="content-card-img"
                         {% if city.image %}style="background-image: url('{{ city.image.url }}')"{% endif %}>
                        {% if not city.image %}
                        <div class="d-flex align-items-center justify-content-center h-100 bg-light">
                            <div class="text-center text-muted">
                                <i class="bi bi-image" style="font-size: 2rem;"></i>
                                <div class="small mt-1">No image</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    <div class="content-card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="content-card-title mb-0">{{ city.name }}</h5>
                            <div>
                                {% if not city.image %}<span class="badge bg-warning text-dark me-1" title="Missing image"><i class="bi bi-exclamation-triangle"></i></span>{% endif %}
                                {% if city.is_published %}
                                <span class="badge badge-published">Published</span>
                                {% else %}
                                <span class="badge badge-draft">Draft</span>
                                {% endif %}
                            </div>
                        </div>
                        <p class="content-card-meta mb-2">
                            <i class="bi bi-shop me-1"></i> {{ city.venue_count }} venues
                            {% if city.has_beaches %}<i class="bi bi-water ms-2 text-primary"></i>{% endif %}
                        </p>
                        <div class="d-flex gap-2">
                            <a href="{% url 'cms:city_detail' slug=city.slug %}" class="btn btn-sm btn-primary">
                                <i class="bi bi-eye"></i> View
                            </a>
                            <a href="{% url 'cms:city_edit' slug=city.slug %}" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-pencil"></i> Edit
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</div>
{% empty %}
<div class="cms-card">
    <div class="cms-card-body text-center py-5">
        <p class="text-muted mb-0">No regions found. Add regions in Django Admin.</p>
    </div>
</div>
{% endfor %}
{% endblock %}
