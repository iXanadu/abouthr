{% extends 'base.html' %}
{% load static %}
{% load venue_tags %}

{% block extra_js %}
{% if google_maps_api_key %}
<script>
(g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]);for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.googleapis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
  key: "{{ google_maps_api_key }}",
  v: "weekly"
});
</script>
{% endif %}
{% endblock %}

{% block title %}{{ city.name }} - Restaurants, Attractions & Things to Do{% endblock %}

{% block meta_description %}Discover the best of {{ city.name }}, Virginia - top-rated restaurants, cafes, attractions, events{% if city.has_beaches %}, and beaches{% endif %}. Your complete guide to living in {{ city.name }}.{% endblock %}

{% block content %}
<!-- City Hero -->
<section class="city-hero" style="background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.5)), url('{% static 'images/cities/' %}{{ city.slug }}.jpg');">
    <div class="container">
        <span class="region-badge {% if city.region.slug == 'southside' %}southside{% else %}peninsula{% endif %} mb-3">
            {{ city.region.name }}
        </span>
        <h1>{{ city.name }}</h1>
    </div>
</section>

<!-- City Description & Drive Calculator -->
<section class="py-4 py-md-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <p class="lead">{{ city.description }}</p>

                <!-- Drive Time Calculator -->
                {% include 'guide/includes/drive_calculator.html' %}
            </div>
            <div class="col-lg-4">
                {% if weather %}
                <!-- Weather Card -->
                <div class="weather-card mb-3">
                    <div class="weather-current">
                        <div class="weather-temp">
                            <i class="{{ weather.current.icon }} weather-icon"></i>
                            <span class="temp-value">{{ weather.current.temperature }}째</span>
                        </div>
                        <div class="weather-details">
                            <div class="weather-desc">{{ weather.current.description }}</div>
                            <div class="weather-feels">Feels like {{ weather.current.feels_like }}째</div>
                            <div class="weather-meta">
                                <span><i class="bi bi-droplet me-1"></i>{{ weather.current.humidity }}%</span>
                                <span><i class="bi bi-wind me-1"></i>{{ weather.current.wind_speed }} mph</span>
                            </div>
                        </div>
                    </div>
                    <div class="weather-forecast">
                        {% for day in weather.forecast %}
                        <div class="forecast-day">
                            <span class="forecast-date">{{ day.date|date:"D" }}</span>
                            <i class="{{ day.icon }}"></i>
                            <span class="forecast-temps">{{ day.high }}째 / {{ day.low }}째</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <div class="info-card">
                    <h4><i class="bi bi-info-circle me-2"></i>Quick Info</h4>
                    <ul>
                        <li><strong>Region:</strong> {{ city.region.name }}</li>
                        {% if city.has_beaches %}
                        <li><strong>Beaches:</strong> Yes</li>
                        {% endif %}
                        {% if city.school_url %}
                        <li>
                            <a href="{{ city.school_url }}" target="_blank" class="text-decoration-none">
                                <i class="bi bi-mortarboard me-1"></i>School District Info
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>

                {% with utilities=city.vendor_utilities.all %}
                {% if utilities %}
                <div class="info-card">
                    <h4><i class="bi bi-plug me-2"></i>Utilities</h4>
                    <ul class="utilities-list">
                        {% regroup utilities by get_category_display as utilities_by_category %}
                        {% for category in utilities_by_category %}
                        {% for utility in category.list %}
                        {% if utility.is_published %}
                        <li>
                            <strong>{{ category.grouper }}:</strong>
                            {% if utility.website %}
                            <a href="{{ utility.website }}" target="_blank" class="text-decoration-none">
                                {{ utility.name }} <i class="bi bi-box-arrow-up-right small"></i>
                            </a>
                            {% else %}
                            {{ utility.name }}
                            {% endif %}
                            {% if utility.phone %}
                            <br><small class="text-muted"><i class="bi bi-telephone me-1"></i>{{ utility.phone }}</small>
                            {% endif %}
                        </li>
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                    </ul>
                    <a href="{% url 'guide:utilities' %}" class="btn btn-sm btn-outline-primary mt-2">
                        <i class="bi bi-list-ul me-1"></i>All Utilities
                    </a>
                </div>
                {% endif %}
                {% endwith %}
            </div>
        </div>
    </div>
</section>

<!-- Venues Section -->
<section class="pb-5">
    <div class="container">
        <!-- Desktop Tabs -->
        <div class="d-none d-md-block">
            <ul class="nav nav-tabs nav-tabs-venue" id="venuesTabs" role="tablist">
                {% if restaurants %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="restaurants-tab" data-bs-toggle="tab" data-bs-target="#restaurants" type="button" role="tab">
                        <i class="bi bi-cup-hot me-1"></i>Restaurants
                        <span class="badge bg-secondary ms-1">{{ restaurants.count }}</span>
                    </button>
                </li>
                {% endif %}
                {% if cafes %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link {% if not restaurants %}active{% endif %}" id="cafes-tab" data-bs-toggle="tab" data-bs-target="#cafes" type="button" role="tab">
                        <i class="bi bi-cup me-1"></i>Cafes & Breweries
                        <span class="badge bg-secondary ms-1">{{ cafes.count }}</span>
                    </button>
                </li>
                {% endif %}
                {% if attractions %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="attractions-tab" data-bs-toggle="tab" data-bs-target="#attractions" type="button" role="tab">
                        <i class="bi bi-geo-alt me-1"></i>Attractions
                        <span class="badge bg-secondary ms-1">{{ attractions.count }}</span>
                    </button>
                </li>
                {% endif %}
                {% if events %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="events-tab" data-bs-toggle="tab" data-bs-target="#events" type="button" role="tab">
                        <i class="bi bi-calendar-event me-1"></i>Events
                        <span class="badge bg-secondary ms-1">{{ events.count }}</span>
                    </button>
                </li>
                {% endif %}
                {% if beaches %}
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="beaches-tab" data-bs-toggle="tab" data-bs-target="#beaches" type="button" role="tab">
                        <i class="bi bi-umbrella me-1"></i>Beaches
                        <span class="badge bg-secondary ms-1">{{ beaches.count }}</span>
                    </button>
                </li>
                {% endif %}
            </ul>

            <div class="tab-content pt-4" id="venuesTabsContent">
                <!-- Restaurants Tab -->
                {% if restaurants %}
                <div class="tab-pane fade show active" id="restaurants" role="tabpanel">
                    <p class="text-muted mb-4">
                        <i class="bi bi-sort-down me-1"></i>Sorted by rating &middot; {{ restaurants.count }} restaurants
                    </p>
                    <div class="row g-3">
                        {% for venue in restaurants %}
                        <div class="col-md-6 col-lg-4">
                            <div class="venue-card-rich {% if venue|has_photo %}has-photo{% endif %}">
                                {% if venue|has_photo %}
                                <div class="venue-card-image">
                                    <img src="{% url 'guide:venue_photo' venue_id=venue.pk %}?w=400"
                                         alt="{{ venue.name }}"
                                         loading="lazy">
                                    {% if venue.rating %}
                                    <div class="venue-rating-overlay {% venue_badge_class venue %}">
                                        {{ venue.rating }}
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                                <div class="venue-card-header">
                                    <h5 class="venue-name">{{ venue.name }}</h5>
                                    {% if not venue|has_photo and venue.rating %}
                                    <div class="venue-rating-badge {% venue_badge_class venue %}">
                                        {{ venue.rating }}
                                    </div>
                                    {% endif %}
                                </div>

                                <div class="venue-card-body">
                                    {% if venue.rating_count %}
                                    <div class="venue-stars mb-2">
                                        {{ venue.rating|star_display|safe }}
                                        <span class="text-muted small ms-1">({{ venue.rating_count|format_review_count }} reviews)</span>
                                    </div>
                                    {% endif %}

                                    <div class="venue-meta">
                                        {% if venue.price_level_display %}
                                        <span class="venue-price" title="Price level">{{ venue.price_level_display }}</span>
                                        {% endif %}
                                        {% if venue.cuisine_type %}
                                        <span class="venue-cuisine">{{ venue.get_cuisine_type_display }}</span>
                                        {% endif %}
                                        {% with is_open=venue|is_open_now %}
                                        {% if is_open == True %}
                                        <span class="venue-open text-success"><i class="bi bi-clock me-1"></i>Open</span>
                                        {% elif is_open == False %}
                                        <span class="venue-open text-danger"><i class="bi bi-clock me-1"></i>Closed</span>
                                        {% endif %}
                                        {% endwith %}
                                    </div>

                                    {% if venue.address %}
                                    <p class="venue-address text-muted small mb-2">
                                        <i class="bi bi-geo-alt me-1"></i>{{ venue.address|truncatechars:50 }}
                                    </p>
                                    {% endif %}

                                    {% with hours=venue|todays_hours %}
                                    {% if hours %}
                                    <p class="venue-hours text-muted small mb-0">
                                        <i class="bi bi-clock me-1"></i>Today: {{ hours }}
                                    </p>
                                    {% endif %}
                                    {% endwith %}
                                </div>

                                {% if venue.website or venue.phone %}
                                <div class="venue-card-footer">
                                    {% if venue.website %}
                                    <a href="{{ venue.website }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-globe me-1"></i>Website
                                    </a>
                                    {% endif %}
                                    {% if venue.phone %}
                                    <a href="tel:{{ venue.phone }}" class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-telephone me-1"></i>Call
                                    </a>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Cafes Tab -->
                {% if cafes %}
                <div class="tab-pane fade {% if not restaurants %}show active{% endif %}" id="cafes" role="tabpanel">
                    <p class="text-muted mb-4">
                        <i class="bi bi-sort-down me-1"></i>Sorted by rating &middot; {{ cafes.count }} cafes & breweries
                    </p>
                    <div class="row g-3">
                        {% for venue in cafes %}
                        <div class="col-md-6 col-lg-4">
                            <div class="venue-card-rich {% if venue|has_photo %}has-photo{% endif %}">
                                {% if venue|has_photo %}
                                <div class="venue-card-image">
                                    <img src="{% url 'guide:venue_photo' venue_id=venue.pk %}?w=400"
                                         alt="{{ venue.name }}"
                                         loading="lazy">
                                    {% if venue.rating %}
                                    <div class="venue-rating-overlay {% venue_badge_class venue %}">
                                        {{ venue.rating }}
                                    </div>
                                    {% endif %}
                                </div>
                                {% endif %}
                                <div class="venue-card-header">
                                    <h5 class="venue-name">{{ venue.name }}</h5>
                                    {% if not venue|has_photo and venue.rating %}
                                    <div class="venue-rating-badge {% venue_badge_class venue %}">
                                        {{ venue.rating }}
                                    </div>
                                    {% endif %}
                                </div>

                                <div class="venue-card-body">
                                    {% if venue.rating_count %}
                                    <div class="venue-stars mb-2">
                                        {{ venue.rating|star_display|safe }}
                                        <span class="text-muted small ms-1">({{ venue.rating_count|format_review_count }} reviews)</span>
                                    </div>
                                    {% endif %}

                                    <div class="venue-meta">
                                        {% if venue.price_level_display %}
                                        <span class="venue-price" title="Price level">{{ venue.price_level_display }}</span>
                                        {% endif %}
                                        {% if venue.cuisine_type %}
                                        <span class="venue-cuisine">{{ venue.get_cuisine_type_display }}</span>
                                        {% endif %}
                                        {% with is_open=venue|is_open_now %}
                                        {% if is_open == True %}
                                        <span class="venue-open text-success"><i class="bi bi-clock me-1"></i>Open</span>
                                        {% elif is_open == False %}
                                        <span class="venue-open text-danger"><i class="bi bi-clock me-1"></i>Closed</span>
                                        {% endif %}
                                        {% endwith %}
                                    </div>

                                    {% if venue.address %}
                                    <p class="venue-address text-muted small mb-2">
                                        <i class="bi bi-geo-alt me-1"></i>{{ venue.address|truncatechars:50 }}
                                    </p>
                                    {% endif %}

                                    {% with hours=venue|todays_hours %}
                                    {% if hours %}
                                    <p class="venue-hours text-muted small mb-0">
                                        <i class="bi bi-clock me-1"></i>Today: {{ hours }}
                                    </p>
                                    {% endif %}
                                    {% endwith %}
                                </div>

                                {% if venue.website or venue.phone %}
                                <div class="venue-card-footer">
                                    {% if venue.website %}
                                    <a href="{{ venue.website }}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-globe me-1"></i>Website
                                    </a>
                                    {% endif %}
                                    {% if venue.phone %}
                                    <a href="tel:{{ venue.phone }}" class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-telephone me-1"></i>Call
                                    </a>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Attractions Tab -->
                {% if attractions %}
                <div class="tab-pane fade" id="attractions" role="tabpanel">
                    <p class="text-muted mb-4">{{ attractions.count }} attractions to explore</p>
                    <div class="row g-3">
                        {% for venue in attractions %}
                        <div class="col-md-6 col-lg-4">
                            <div class="venue-card-simple">
                                <h5><i class="bi bi-geo-alt text-primary me-2"></i>{{ venue.name }}</h5>
                                {% if venue.description %}
                                <p class="text-muted small mb-2">{{ venue.description|truncatechars:100 }}</p>
                                {% endif %}
                                {% if venue.address %}
                                <p class="small text-muted mb-0">{{ venue.address }}</p>
                                {% endif %}
                                {% if venue.website %}
                                <a href="{{ venue.website }}" target="_blank" class="small">Learn more</a>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Events Tab -->
                {% if events %}
                <div class="tab-pane fade" id="events" role="tabpanel">
                    <p class="text-muted mb-4">{{ events.count }} annual events & festivals</p>
                    <div class="row g-3">
                        {% for venue in events %}
                        <div class="col-md-6 col-lg-4">
                            <div class="venue-card-simple">
                                <h5><i class="bi bi-calendar-event text-primary me-2"></i>{{ venue.name }}</h5>
                                {% if venue.description %}
                                <p class="text-muted small mb-2">{{ venue.description|truncatechars:100 }}</p>
                                {% endif %}
                                {% if venue.website %}
                                <a href="{{ venue.website }}" target="_blank" class="small">Event info</a>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Beaches Tab -->
                {% if beaches %}
                <div class="tab-pane fade" id="beaches" role="tabpanel">
                    <p class="text-muted mb-4">{{ beaches.count }} beaches to visit</p>
                    <div class="row g-3">
                        {% for venue in beaches %}
                        <div class="col-md-6 col-lg-4">
                            <div class="venue-card-simple venue-card-beach">
                                <h5><i class="bi bi-umbrella text-info me-2"></i>{{ venue.name }}</h5>
                                {% if venue.description %}
                                <p class="text-muted small mb-2">{{ venue.description|truncatechars:100 }}</p>
                                {% endif %}
                                {% if venue.address %}
                                <p class="small text-muted mb-0">
                                    <i class="bi bi-geo-alt me-1"></i>{{ venue.address }}
                                </p>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Mobile Cards -->
        <div class="d-md-none">
            <div class="accordion accordion-venue" id="venuesAccordion">
                {% if restaurants %}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRestaurants">
                            <i class="bi bi-cup-hot me-2"></i>Restaurants
                            <span class="badge bg-secondary ms-2">{{ restaurants.count }}</span>
                        </button>
                    </h2>
                    <div id="collapseRestaurants" class="accordion-collapse collapse show" data-bs-parent="#venuesAccordion">
                        <div class="accordion-body p-2">
                            {% for venue in restaurants %}
                            <div class="venue-card-mobile">
                                {% if venue|has_photo %}
                                <div class="venue-mobile-image">
                                    <img src="{% url 'guide:venue_photo' venue_id=venue.pk %}?w=300"
                                         alt="{{ venue.name }}"
                                         loading="lazy">
                                    {% if venue.rating %}
                                    <div class="venue-rating-overlay {% venue_badge_class venue %}">
                                        <i class="bi bi-star-fill me-1"></i>{{ venue.rating }}
                                    </div>
                                    {% endif %}
                                    {% with is_open=venue|is_open_now %}
                                    {% if is_open == True %}
                                    <div class="venue-open-badge bg-success">Open</div>
                                    {% elif is_open == False %}
                                    <div class="venue-open-badge bg-danger">Closed</div>
                                    {% endif %}
                                    {% endwith %}
                                </div>
                                {% endif %}
                                <div class="venue-mobile-content">
                                    <div class="d-flex justify-content-between align-items-start mb-1">
                                        <h6 class="venue-mobile-name mb-0">{{ venue.name }}</h6>
                                        {% if not venue|has_photo and venue.rating %}
                                        <span class="venue-rating-badge-sm {% venue_badge_class venue %}">
                                            {{ venue.rating }}
                                        </span>
                                        {% endif %}
                                    </div>

                                    <div class="venue-mobile-meta mb-2">
                                        {% if venue.rating_count %}
                                        <span class="text-warning small">
                                            {{ venue.rating|star_display|safe }}
                                        </span>
                                        <span class="text-muted small">({{ venue.rating_count|format_review_count }})</span>
                                        {% endif %}
                                        {% if venue.price_level_display %}
                                        <span class="venue-price-mobile">{{ venue.price_level_display }}</span>
                                        {% endif %}
                                        {% if venue.cuisine_type %}
                                        <span class="text-muted">&middot; {{ venue.get_cuisine_type_display }}</span>
                                        {% endif %}
                                    </div>

                                    {% if venue.address %}
                                    <p class="venue-mobile-address text-muted small mb-2">
                                        <i class="bi bi-geo-alt"></i> {{ venue.address|truncatechars:45 }}
                                    </p>
                                    {% endif %}

                                    {% with hours=venue|todays_hours %}
                                    {% if hours %}
                                    <p class="text-muted small mb-2">
                                        <i class="bi bi-clock"></i> {{ hours }}
                                    </p>
                                    {% endif %}
                                    {% endwith %}

                                    <div class="venue-mobile-actions">
                                        {% if venue.website %}
                                        <a href="{{ venue.website }}" target="_blank" class="btn btn-sm btn-primary">
                                            <i class="bi bi-globe"></i> Website
                                        </a>
                                        {% endif %}
                                        {% if venue.phone %}
                                        <a href="tel:{{ venue.phone }}" class="btn btn-sm btn-outline-secondary">
                                            <i class="bi bi-telephone"></i> Call
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if cafes %}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCafes">
                            <i class="bi bi-cup me-2"></i>Cafes & Breweries
                            <span class="badge bg-secondary ms-2">{{ cafes.count }}</span>
                        </button>
                    </h2>
                    <div id="collapseCafes" class="accordion-collapse collapse" data-bs-parent="#venuesAccordion">
                        <div class="accordion-body p-2">
                            {% for venue in cafes %}
                            <div class="venue-card-mobile">
                                {% if venue|has_photo %}
                                <div class="venue-mobile-image">
                                    <img src="{% url 'guide:venue_photo' venue_id=venue.pk %}?w=300"
                                         alt="{{ venue.name }}"
                                         loading="lazy">
                                    {% if venue.rating %}
                                    <div class="venue-rating-overlay {% venue_badge_class venue %}">
                                        <i class="bi bi-star-fill me-1"></i>{{ venue.rating }}
                                    </div>
                                    {% endif %}
                                    {% with is_open=venue|is_open_now %}
                                    {% if is_open == True %}
                                    <div class="venue-open-badge bg-success">Open</div>
                                    {% elif is_open == False %}
                                    <div class="venue-open-badge bg-danger">Closed</div>
                                    {% endif %}
                                    {% endwith %}
                                </div>
                                {% endif %}
                                <div class="venue-mobile-content">
                                    <div class="d-flex justify-content-between align-items-start mb-1">
                                        <h6 class="venue-mobile-name mb-0">{{ venue.name }}</h6>
                                        {% if not venue|has_photo and venue.rating %}
                                        <span class="venue-rating-badge-sm {% venue_badge_class venue %}">
                                            {{ venue.rating }}
                                        </span>
                                        {% endif %}
                                    </div>

                                    <div class="venue-mobile-meta mb-2">
                                        {% if venue.rating_count %}
                                        <span class="text-warning small">
                                            {{ venue.rating|star_display|safe }}
                                        </span>
                                        <span class="text-muted small">({{ venue.rating_count|format_review_count }})</span>
                                        {% endif %}
                                        {% if venue.price_level_display %}
                                        <span class="venue-price-mobile">{{ venue.price_level_display }}</span>
                                        {% endif %}
                                        {% if venue.cuisine_type %}
                                        <span class="text-muted">&middot; {{ venue.get_cuisine_type_display }}</span>
                                        {% endif %}
                                    </div>

                                    {% if venue.address %}
                                    <p class="venue-mobile-address text-muted small mb-2">
                                        <i class="bi bi-geo-alt"></i> {{ venue.address|truncatechars:45 }}
                                    </p>
                                    {% endif %}

                                    <div class="venue-mobile-actions">
                                        {% if venue.website %}
                                        <a href="{{ venue.website }}" target="_blank" class="btn btn-sm btn-primary">
                                            <i class="bi bi-globe"></i> Website
                                        </a>
                                        {% endif %}
                                        {% if venue.phone %}
                                        <a href="tel:{{ venue.phone }}" class="btn btn-sm btn-outline-secondary">
                                            <i class="bi bi-telephone"></i> Call
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if attractions %}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAttractions">
                            <i class="bi bi-geo-alt me-2"></i>Attractions
                            <span class="badge bg-secondary ms-2">{{ attractions.count }}</span>
                        </button>
                    </h2>
                    <div id="collapseAttractions" class="accordion-collapse collapse" data-bs-parent="#venuesAccordion">
                        <div class="accordion-body p-2">
                            {% for venue in attractions %}
                            <div class="venue-card-mobile-simple">
                                <div class="d-flex align-items-start">
                                    <div class="venue-mobile-icon bg-primary">
                                        <i class="bi bi-geo-alt-fill"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">{{ venue.name }}</h6>
                                        {% if venue.description %}
                                        <p class="text-muted small mb-1">{{ venue.description|truncatechars:80 }}</p>
                                        {% endif %}
                                        {% if venue.address %}
                                        <p class="text-muted small mb-0"><i class="bi bi-geo-alt"></i> {{ venue.address|truncatechars:40 }}</p>
                                        {% endif %}
                                        {% if venue.website %}
                                        <a href="{{ venue.website }}" target="_blank" class="btn btn-sm btn-link p-0 mt-1">Learn more</a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if events %}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEvents">
                            <i class="bi bi-calendar-event me-2"></i>Events
                            <span class="badge bg-secondary ms-2">{{ events.count }}</span>
                        </button>
                    </h2>
                    <div id="collapseEvents" class="accordion-collapse collapse" data-bs-parent="#venuesAccordion">
                        <div class="accordion-body p-2">
                            {% for venue in events %}
                            <div class="venue-card-mobile-simple">
                                <div class="d-flex align-items-start">
                                    <div class="venue-mobile-icon bg-warning">
                                        <i class="bi bi-calendar-event-fill"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">{{ venue.name }}</h6>
                                        {% if venue.description %}
                                        <p class="text-muted small mb-1">{{ venue.description|truncatechars:100 }}</p>
                                        {% endif %}
                                        {% if venue.website %}
                                        <a href="{{ venue.website }}" target="_blank" class="btn btn-sm btn-link p-0">Event info</a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if beaches %}
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBeaches">
                            <i class="bi bi-umbrella me-2"></i>Beaches
                            <span class="badge bg-secondary ms-2">{{ beaches.count }}</span>
                        </button>
                    </h2>
                    <div id="collapseBeaches" class="accordion-collapse collapse" data-bs-parent="#venuesAccordion">
                        <div class="accordion-body p-2">
                            {% for venue in beaches %}
                            <div class="venue-card-mobile-simple venue-card-mobile-beach">
                                <div class="d-flex align-items-start">
                                    <div class="venue-mobile-icon bg-info">
                                        <i class="bi bi-umbrella-fill"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">{{ venue.name }}</h6>
                                        {% if venue.description %}
                                        <p class="text-muted small mb-1">{{ venue.description|truncatechars:80 }}</p>
                                        {% endif %}
                                        {% if venue.address %}
                                        <p class="text-muted small mb-0"><i class="bi bi-geo-alt"></i> {{ venue.address }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Explore Other Cities -->
<section class="py-5 bg-light-custom">
    <div class="container">
        <h3 class="mb-4">Explore Other Cities</h3>
        <div class="row g-3">
            {% for other_city in other_cities %}
            <div class="col-6 col-md-4 col-lg-3">
                <a href="{% url 'guide:city_detail' slug=other_city.slug %}" class="btn btn-outline-secondary w-100">
                    {{ other_city.name }}
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- CTA -->
<section class="py-5 bg-primary text-white">
    <div class="container text-center">
        <h3 class="mb-3">Looking for a Home in {{ city.name }}?</h3>
        <p class="mb-4 opacity-75">Let us help you find the perfect home in {{ city.name }}.</p>
        <a href="https://explorevirginiahomes.com" target="_blank" class="btn btn-light btn-lg">
            <i class="bi bi-search me-2"></i>Search {{ city.name }} Homes
        </a>
    </div>
</section>
{% endblock %}
